<style>.pjs-rectangle{background:url(envelope.png) no-repeat}#mofo-eoy-2014 p{text-align:center;font-size:17px;font-family:"Open Sans"}#mofo-eoy-2014 img{position:relative;top:12px;margin-right:5px}</style>

<div class="snippet">
  <div id="mofo-eoy-2014" class="disruptive">
    <p><img src="envelope.png" id="primary-envelope"> A new message from another <em>Firefox</em> user like you.</p>
  </div>
</div>

<script>!function(t,e){"object"==typeof exports?module.exports=e.call(t):"function"==typeof define&&define.amd?define(function(){return e.call(t)}):t.Physics=e.call(t)}(this,function(){"use strict";var t=this,e=t.document,i=function o(){return o.world.apply(o,arguments)};i.util={},function(){i.aabb=function(t,e,i,n){var o={x:0,y:0,hw:0,hh:0};return void 0===t?o:(t&&void 0!==t.x&&(i=e.x,n=e.y,e=t.y,t=t.x),void 0===n&&void 0!==t&&void 0!==e?(o.hw=.5*t,o.hh=.5*e,i&&void 0!==i.x&&(o.x=i.x,o.y=i.y),o):(o.hw=.5*Math.abs(i-t),o.hh=.5*Math.abs(n-e),o.x=.5*(i+t),o.y=.5*(n+e),o))},i.aabb.contains=function(t,e){return e.x>t.x-t.hw&&e.x<t.x+t.hw&&e.y>t.y-t.hh&&e.y<t.y+t.hh},i.aabb.clone=function(t){return{x:t.x,y:t.y,hw:t.hw,hh:t.hh}},i.aabb.overlap=function(t,e){var i=t.x-t.hw,n=e.x-e.hw,o=t.x+t.hw,r=e.x+e.hw;return o>=n&&r>=o||r>=i&&o>=r?(i=t.y-t.hh,n=e.y-e.hh,o=t.y+t.hh,r=e.y+e.hh,o>=n&&r>=o||r>=i&&o>=r):!1}}(),function(){var t=1e-4,e=100,n=function(t,e,i){var n=e.normSq()-e.dot(t),o=e.dot(t)-t.normSq();return 0>n?i.clone(e).negate():o>0?i.clone(t).negate():(i.clone(e).vsub(t),i.perp(t.cross(i)>0))},o=function(t){var e,n,o=t.length,r=t[o-2],s=t[o-3],a=i.scratchpad(),h=a.vector().clone(r.pt),l=a.vector().clone(s.pt).vsub(h);return l.equals(i.vector.zero)?a.done({a:r.a,b:r.b}):(e=-l.dot(h)/l.normSq(),n=1-e,a.done(0>=n?{a:s.a,b:s.b}:0>=e?{a:r.a,b:r.b}:{a:h.clone(r.a).mult(n).vadd(l.clone(s.a).mult(e)).values(),b:h.clone(r.b).mult(n).vadd(l.clone(s.b).mult(e)).values()}))},r=function(r,s,a,h){var l,c,u,d,f=!1,p=!1,v=!1,y=[],m=1,g=i.scratchpad(),b=g.vector().clone(s||i.vector.axis[0]),_=g.vector(),w=g.vector(),x=g.vector(),P=g.vector(),C=0;for(d=r(b),m=y.push(d),_.clone(d.pt),b.negate();++C;){if(_.swap(w),d=r(b),m=y.push(d),_.clone(d.pt),h&&h(y),_.equals(i.vector.zero)){f=!0;break}if(!p&&_.dot(b)<=0){if(a)break;p=!0}if(2===m)b=n(_,w,b);else if(p){if(b.normalize(),d=w.dot(b),Math.abs(d-_.dot(b))<t){v=-d;break}w.normSq()<x.clone(y[0].pt).normSq()?y.shift():y.splice(1,1),b=n(x.clone(y[1].pt),P.clone(y[0].pt),b)}else if(l=l||g.vector(),c=c||g.vector(),l.clone(w).vsub(_),c.clone(y[0].pt).vsub(_),u=l.cross(c)>0,u^_.cross(l)>0)y.shift(),l.perp(!u),b.swap(l);else{if(!(u^c.cross(_)>0)){f=!0;break}y.splice(1,1),c.perp(u),b.swap(l)}if(C>e)return g.done(),{simplex:y,iterations:C,distance:0,maxIterationsReached:!0}}return g.done(),d={overlap:f,simplex:y,iterations:C},v!==!1&&(d.distance=v,d.closest=o(y)),d};i.gjk=r}(),function(){var t=function e(t,n,o){return this instanceof e?(this.v=i.vector(),this.o=i.vector(),t instanceof e?void this.clone(t):(t&&this.setTranslation(t),void this.setRotation(n||0,o))):new e(t,n)};t.prototype.setTranslation=function(t){return this.v.clone(t),this},t.prototype.setRotation=function(t,e){return this.cosA=Math.cos(t),this.sinA=Math.sin(t),e?this.o.clone(e):this.o.zero(),this},t.prototype.clone=function(e){return e?(this.setTranslation(e.v),this.cosA=e.cosA,this.sinA=e.sinA,this.o.clone(e.o),this):new t(this)},i.transform=t}(),function(t){var e=Math.sqrt,n=Math.min,o=Math.max,r=(Math.acos,Math.atan2),s=2*Math.PI,a=!!t.Float64Array,h=function l(t,e){return this instanceof l?(this._=a?new Float64Array(5):[],void(t&&(void 0!==t.x||t._&&t._.length)?this.clone(t):(this.recalc=!0,this.set(t,e)))):new l(t,e)};Object.defineProperties(h.prototype,{x:{get:function(){return+this._[0]},set:function(t){t=+t||0,this.recalc=t===this._[0],this._[0]=t}},y:{get:function(){return+this._[1]},set:function(t){t=+t||0,this.recalc=t===this._[1],this._[1]=t}}}),h.prototype.set=function(t,e){return this.recalc=!0,this._[0]=+t||0,this._[1]=+e||0,this},h.prototype.get=function(t){return this._[t]},h.prototype.vadd=function(t){return this.recalc=!0,this._[0]+=t._[0],this._[1]+=t._[1],this},h.prototype.vsub=function(t){return this.recalc=!0,this._[0]-=t._[0],this._[1]-=t._[1],this},h.prototype.add=function(t,e){return this.recalc=!0,this._[0]+=+t||0,this._[1]+=+e||0,this},h.prototype.sub=function(t,e){return this.recalc=!0,this._[0]-=t,this._[1]-=void 0===e?0:e,this},h.prototype.mult=function(t){return this.recalc||(this._[4]*=t*t,this._[3]*=t),this._[0]*=t,this._[1]*=t,this},h.prototype.dot=function(t){return this._[0]*t._[0]+this._[1]*t._[1]},h.prototype.cross=function(t){return-this._[0]*t._[1]+this._[1]*t._[0]},h.prototype.proj=function(t){return this.dot(t)/t.norm()},h.prototype.vproj=function(t){var e=this.dot(t)/t.normSq();return this.clone(t).mult(e)},h.prototype.angle=function(t){var e;if(this.equals(h.zero))return t?t.angle():0/0;for(e=t&&!t.equals(h.zero)?r(this._[1]*t._[0]-this._[0]*t._[1],this._[0]*t._[0]+this._[1]*t._[1]):r(this._[1],this._[0]);e>Math.PI;)e-=s;for(;e<-Math.PI;)e+=s;return e},h.prototype.angle2=function(t,e){for(var i=t._[0]-this._[0],n=t._[1]-this._[1],o=e._[0]-this._[0],a=e._[1]-this._[1],h=r(n*o-i*a,i*o+n*a);h>Math.PI;)h-=s;for(;h<-Math.PI;)h+=s;return h},h.prototype.norm=function(){return this.recalc&&(this.recalc=!1,this._[4]=this._[0]*this._[0]+this._[1]*this._[1],this._[3]=e(this._[4])),this._[3]},h.prototype.normSq=function(){return this.recalc&&(this.recalc=!1,this._[4]=this._[0]*this._[0]+this._[1]*this._[1],this._[3]=e(this._[4])),this._[4]},h.prototype.dist=function(t){var i,n;return e((i=t._[0]-this._[0])*i+(n=t._[1]-this._[1])*n)},h.prototype.distSq=function(t){var e,i;return(e=t._[0]-this._[0])*e+(i=t._[1]-this._[1])*i},h.prototype.perp=function(t){var e=this._[0];return t?(this._[0]=this._[1],this._[1]=-e):(this._[0]=-this._[1],this._[1]=e),this},h.prototype.normalize=function(){var t=this.norm();return 0===t?this:(t=1/t,this._[0]*=t,this._[1]*=t,this._[3]=1,this._[4]=1,this)},h.prototype.transform=function(t){var e=t.sinA,i=t.cosA,n=t.o._[0],o=t.o._[1];return this._[0]-=n,this._[1]-=o,this.set(this._[0]*i-this._[1]*e+n+t.v._[0],this._[0]*e+this._[1]*i+o+t.v._[1])},h.prototype.transformInv=function(t){var e=t.sinA,i=t.cosA,n=t.o._[0],o=t.o._[1];return this._[0]-=n+t.v._[0],this._[1]-=o+t.v._[1],this.set(this._[0]*i+this._[1]*e+n,-this._[0]*e+this._[1]*i+o)},h.prototype.rotate=function(t,e){var i,n,o=0,r=0;return"number"==typeof t?(i=Math.sin(t),n=Math.cos(t),e&&(o=0|(e.x||e._[0]),r=0|(e.y||e._[1]))):(i=t.sinA,n=t.cosA,o=t.o._[0],r=t.o._[1]),this._[0]-=o,this._[1]-=r,this.set(this._[0]*n-this._[1]*i+o,this._[0]*i+this._[1]*n+r)},h.prototype.rotateInv=function(t){return this.set((this._[0]-t.o._[0])*t.cosA+(this._[1]-t.o._[1])*t.sinA+t.o._[0],-(this._[0]-t.o._[0])*t.sinA+(this._[1]-t.o._[1])*t.cosA+t.o._[1])},h.prototype.translate=function(t){return this.vadd(t.v)},h.prototype.translateInv=function(t){return this.vsub(t.v)},h.prototype.clone=function(t){return t?t._?(this.recalc=t.recalc,t.recalc||(this._[3]=t._[3],this._[4]=t._[4]),this._[0]=t._[0],this._[1]=t._[1],this):this.set(t.x,t.y):new h(this)},h.prototype.swap=function(t){var e=this._;return this._=t._,t._=e,e=this.recalc,this.recalc=t.recalc,t.recalc=e,this},h.prototype.values=function(){return{x:this._[0],y:this._[1]}},h.prototype.zero=function(){return this._[3]=0,this._[4]=0,this._[0]=0,this._[1]=0,this},h.prototype.negate=function(t){return void 0!==t?(this._[t]=-this._[t],this):(this._[0]=-this._[0],this._[1]=-this._[1],this)},h.prototype.clamp=function(t,e){return this._[0]=n(o(this._[0],t.x),e.x),this._[1]=n(o(this._[1],t.y),e.y),this.recalc=!0,this},h.prototype.toString=function(){return"("+this._[0]+", "+this._[1]+")"},h.prototype.equals=function(t){return this._[0]===t._[0]&&this._[1]===t._[1]&&this._[2]===t._[2]},h.axis=[new h(1,0),new h(0,1)],h.zero=new h(0,0),i.vector=h}(this),function(t){var e=t.Physics;i.noConflict=function(){return t.Physics===i&&(t.Physics=e),i}}(this);var n=i.util.decorator=function(t,e){var n={},o={},r=function(t,e){var n,o;for(o in e)n=Object.getOwnPropertyDescriptor(e,o),n.get||n.set?Object.defineProperty(t,o,n):i.util.isFunction(n.value)&&(t[o]=n.value);return t},s=Object.getPrototypeOf;"function"!=typeof s&&(s="object"==typeof"test".__proto__?function(t){return t.__proto__}:function(t){return t.constructor.prototype});var a=Object.create;"function"!=typeof a&&(a=function(t){function e(){}return e.prototype=t,new e});var h=function(e,n){return"object"==typeof e?(o=r(o,e),void(o.type=t)):void("type"!==e&&i.util.isFunction(n)&&(o[e]=n))};h(e);var l=function(e,i,h,l){var c,u=o;if("string"!=typeof i)l=h,h=i;else{if(u=n[i],!u)throw'Error: "'+i+'" '+t+" not defined";u=u.prototype}if("function"==typeof h)c=n[e],c?c.prototype=r(c.prototype,h(s(c.prototype))):(c=n[e]=function(t){this.init&&this.init(t)},c.prototype=a(u),c.prototype=r(c.prototype,h(u,c.prototype))),c.prototype.type=t,c.prototype.name=e;else if(l=h||{},c=n[e],!c)throw'Error: "'+e+'" '+t+" not defined";return l?new c(l):void 0};return l.mixin=h,l};return i.util.indexOf=function(t,e){for(var i=0,n=t.length;n>i;){if(n--,t[i]===e)return i;if(t[n]===e)return n;i++}return-1},i.util.throttle=function(t,e,i){var n,o,r=!1,s=function(){clearTimeout(n),r?(r=!1,n=setTimeout(s,e),t.apply(i,o)):n=!1};return i=i||null,function(){r=!0,o=arguments,n||s()}},i.util.options=function(t,e){var n,o={},r=[];return n=function(t){i.util.extend(e,t,null);for(var n=0,o=r.length;o>n;++n)r[n](e);return e},n.defaults=function(t){return i.util.extend(o,t),i.util.defaults(e,o),o},n.onChange=function(t){r.push(t)},e=e||n,n.defaults(t),n},i.util.pairHash=function(t,e){return t=0|t,e=0|e,(0|t)===(0|e)?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},i.util.bind=Function.prototype.bind?function(t,e,i){return i=Array.prototype.slice.call(arguments,1),Function.prototype.bind.apply(t,i)}:function(t,e,i){return i=Array.prototype.slice.call(arguments,2),function(){return t.apply(e,i.concat(Array.prototype.slice.call(arguments)))}},i.util.find=function(t,e){var i,n,o=t.length;for(i=0;o>i;i++)if(n=t[i],e(n,i,t))return n},i.util.filter=function(t,e){var i,n,o=t.length,r=[];for(i=0;o>i;i++)n=t[i],e(n,i,t)&&r.push(n);return r},function(){function t(t){t.length=0,w.length<P&&w.push(t)}function e(t){var i=t.cache;i&&e(i),t.array=t.cache=t.criteria=t.object=t.number=t.string=t.value=null,x.length<P&&x.push(t)}function n(){return x.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function o(){return w.pop()||[]}function r(t,e){var n=typeof e;if(t=t.cache,"boolean"===n||null==e)return t[e]?0:-1;"number"!==n&&"string"!==n&&(n="object");var o="number"===n?e:C+e;return t=(t=t[n])&&t[o],"object"===n?t&&i.util.indexOf(t,e)>-1?0:-1:t?0:-1}function s(t){var e=this.cache,i=typeof t;if("boolean"===i||null==t)e[t]=!0;else{"number"!==i&&"string"!==i&&(i="object");var n="number"===i?t:C+t,o=e[i]||(e[i]={});"object"===i?(o[n]||(o[n]=[])).push(t):o[n]=!0}}function a(t){var e=-1,i=t.length,o=t[0],r=t[0|i/2],a=t[i-1];if(o&&"object"==typeof o&&r&&"object"==typeof r&&a&&"object"==typeof a)return!1;var h=n();h["false"]=h["null"]=h["true"]=h.undefined=!1;var l=n();for(l.array=t,l.cache=h,l.push=s;++e<i;)l.push(t[e]);return l}function h(t,e){return t+Math.floor(Math.random()*(e-t+1))}function l(t){return"function"==typeof t}function c(t){return"function"==typeof t&&B.test(t)}function u(t){var e,i;if(!t||g.call(t)!==y||(e=t.constructor,l(e)&&!(e instanceof e)))return!1;for(var n in t)i=n;return"undefined"==typeof i||b.call(t,i)}function d(n,s,h){var l=-1,c=i.util.indexOf,u=n?n.length:0,d=[],f=!s&&u>=_&&c===i.util.indexOf,p=h||f?o():d;if(f){var v=a(p);c=r,p=v}for(;++l<u;){var y=n[l],m=h?h(y,l,n):y;(s?!l||p[p.length-1]!==m:c(p,m)<0)&&((h||f)&&p.push(m),d.push(y))}return f?(t(p.array),e(p)):h&&t(p),d}var f={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},p=function(t){return t},v="[object Array]",y="[object Object]",m=Object.keys,g=Object.prototype.toString,b=Object.prototype.hasOwnProperty,_=75,w=[],x=[],P=40,C=+new Date+"",A=function(t){var e,i=t,n=[];if(!i)return n;if(!f[typeof t])return n;for(e in i)b.call(i,e)&&n.push(e);return n},I=m?function(t){return i.util.isObject(t)?m(t):[]}:A,k=0;i.util.uniqueId=function(t){var e=++k;return""+(t||"")+e},i.util.shuffle=function(t){var e,i,n,o,r=-1,s=t?t.length:0,a=Array("number"==typeof s?s:0);for(e=0,i=t.length;i>e;e++)n=t[e],o=h(0,++r),a[r]=a[o],a[o]=n;return a},i.util.isObject=function(t){return!(!t||!f[typeof t])},i.util.isFunction=l,i.util.isArray=Array.isArray||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&g.call(t)===v||!1};var B=RegExp("^"+String(g).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");i.util.isPlainObject=Object.getPrototypeOf?function(t){if(!t||g.call(t)!==y)return!1;var e=t.valueOf,i=c(e)&&(i=Object.getPrototypeOf(e))&&Object.getPrototypeOf(i);return i?t===i||Object.getPrototypeOf(t)===i:u(t)}:u,i.util.uniq=function(t,e,i){return"boolean"!=typeof e&&null!=e&&(i=e,e=!1),d(t,e,i)};var T=function(t,e,i){var n,o=t,r=o;if(!o)return r;var s,a=arguments,h=0,l="number"==typeof i?2:a.length;for(l>2&&"function"==typeof a[l-1]&&(s=a[--l]);++h<l;)if(o=a[h],o&&f[typeof o])for(var c=-1,u=f[typeof o]&&I(o),d=u?u.length:0;++c<d;)n=u[c],r[n]=s?s(r[n],o[n]):o[n];return r};i.util.extend=T,i.util.defaults=function(t,e,i){var n,o=t,r=o;if(!o)return r;for(var s=arguments,a=0,h="number"==typeof i?2:s.length;++a<h;)if(o=s[a],o&&f[typeof o])for(var l=-1,c=f[typeof o]&&I(o),u=c?c.length:0;++l<u;)n=c[l],"undefined"==typeof r[n]&&(r[n]=o[n]);return r},i.util.sortedIndex=function(t,e,i){var n=0,o=t?t.length:n;for(i=i||p,e=i(e);o>n;){var r=n+o>>>1;i(t[r])<e?n=r+1:o=r}return n}}(),i.scratchpad=function(){var t,e,n="Error: Scratchpad used after .done() called. (Could it be unintentionally scoped?)",o="Error: Scratchpad usage space out of bounds. (Did you forget to call .done()?)",r="Error: Too many scratchpads created. (Did you forget to call .done()?)",s="Error: Object is already registered.",a=[],h=0,l=0;return t=function(){if(this._active=!1,this._indexArr=[],++h>=e.maxScratches)throw r},t.prototype={done:function(t){this._active=!1;for(var e=0;l>e;++e)this[e]=0;return a.push(this),t}},e=function c(e){if(e)return c.fn(e);var i=a.pop()||new t;return i._active=!0,i},e.maxScratches=100,e.maxIndex=20,e.fn=function(e){for(var i=[],n=0,o=e.length;o>n;n++)i.push(n);i="a"+i.join(",a");var r=new Function("fn, scratches, Scratch","return function("+i+"){ var scratch = scratches.pop() || new Scratch( scratches );scratch._active = true;return scratch.done( fn(scratch, "+i+") );};");return r(e,a,t)},e.register=function(i,r,a){var h=t.prototype,c=l++,u="_"+i+"Stack",d=a&&a.useFactory;if(i in h)throw s;h[i]=function(){var t=this[u]||(this[u]=[]),i=0|this[c];if(this[c]=i+1,!this._active)throw n;if(i>=e.maxIndex)throw o;return t[i]||(t[i]=d?r():new r)}},e.register("vector",i.vector),e.register("transform",i.transform),e}(),function(){function t(t){return t._priority_}i.scratchpad.register("event",function(){return{}},{useFactory:!0});var e=function n(){return this instanceof n?void 0:new n};e.prototype={on:function(e,n,o,r){var s,a,h;if(this._topics=this._topics||(this._topics={}),i.util.isObject(e)){for(var l in e)this.on(l,e[l],n,o);return this}return s=this._topics[e]||(this._topics[e]=[]),a=n,i.util.isObject(o)?(n=i.util.bind(n,o),n._bindfn_=a,n._one_=a._one_):r||(r=o),n._priority_=r,h=i.util.sortedIndex(s,n,t),s.splice(h,0,n),this},off:function(t,e){var n,o;if(!this._topics)return this;if(t===!0)return this._topics={},this;if(i.util.isObject(t)){for(var r in t)this.off(r,t[r]);return this}if(n=this._topics[t],!n)return this;if(e===!0)return this._topics[t]=[],this;for(var s=0,a=n.length;a>s;s++)if(o=n[s],o._bindfn_===e||o===e){n.splice(s,1);break}return this},emit:function(t,e){if(!this._topics)return this;var n,o,r=this._topics[t],s=r&&r.length,a=i.scratchpad();if(!s)return a.done(this);for(o=a.event(),o.topic=t,o.handler=n;s--;)n=r[s],n(e,o),n._one_&&r.splice(s,1);return a.done(this)},one:function(t,e,n){if(i.util.isObject(t)){for(var o in t)this.one(o,t[o],e,n);return this}return e._one_=!0,this.on(t,e,n),this}},i.util.pubsub=e}(),function(t){function e(){return u&&u.now?u.now()+u.timing.navigationStart:Date.now()}function n(){var i;l&&(i=e(),i&&(t.requestAnimationFrame(n),c.emit("tick",i)))}function o(){return l=!0,n(),this}function r(){return l=!1,this}function s(t){return c.on("tick",t),this}function a(t){return c.off("tick",t),this}function h(){return!!l}var l=!1,c=i.util.pubsub(),u=t.performance;i.util.ticker={now:e,start:o,stop:r,on:s,off:a,isActive:h}}(this),function(){var t=function(){return!0},e=i.util.indexOf,n=function(t,e){return function(i){return t(i[e])}},o=function(t,n){return function(o){o=n?o[n]:o;var r,s=0;if(i.util.isArray(o)){if(i.util.isArray(t)){if(r=o.length,r!==t.length)return!1;for(;r>s;){if(r--,-1===e(t,o[s])||-1===e(t,o[r]))return!1;s++}return!0}return e(o,t)>-1}return o===t}},r=function(t,e){var i=o(t,e);return function(t){return!i(t)}},s=function(t,n){return function(o){o=n?o[n]:o;var r,s=0;if(i.util.isArray(o)){for(r=o.length;r>s;){if(r--,e(t,o[s])>-1||e(t,o[r])>-1)return!0;s++}return!1}return e(t,o)>-1}},a=function(t,e){var i=s(t,e);return function(t){return!i(t)}},h=function(t){return t=i.vector(t),function(e){var n=e.aabb();return i.aabb.contains(n,t)}},l=function(t){return t.next?function(e){for(var i=t;i;){if(!i(e))return!1;i=i.next}return!0}:t},c=function(t){return t.next?function(e){for(var i=t;i;){if(i(e))return!0;i=i.next}return!1}:t},u={$eq:o,$ne:r,$in:s,$nin:a,$at:h},d=function f(e,r){var s,a,h,d,p,v;if(r){if("$or"===r||"$and"===r){for(s=0,a=e.length;a>s;++s)v=f(e[s]),p=p?p.next=v:d=v;return"$or"===r?c(d):l(d)}if(s=u[r])return s(e);throw"Unknown query operation: "+r}for(s in e)h=e[s],v="$"===s[0]?f(h,s):i.util.isPlainObject(h)?n(f(h),s):o(h,s),p=p?p.next=v:d=v;return l(d||t)};i.query=d}(this),function(){var t={priority:0};i.behavior=n("behavior",{init:function(e){this.options=i.util.options(t),this.options(e)},applyTo:function(t){return this._targets=t===!0?null:i.util.uniq(t),this},getTargets:function(){return this._targets||(this._world?this._world._bodies:[])},setWorld:function(t){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t),this},connect:function(t){this.behave&&t.on("integrate:positions",this.behave,this,this.options.priority)},disconnect:function(t){this.behave&&t.off("integrate:positions",this.behave)},behave:null})}(),function(){var t={hidden:!1,treatment:"dynamic",mass:1,restitution:1,cof:.8,view:null},e=1;i.body=n("body",{init:function(n){var o=i.vector;if(this.options=i.util.options(t,this),this.options(n),this.state={pos:o(this.x,this.y),vel:o(this.vx,this.vy),acc:o(),angular:{pos:this.angle||0,vel:this.angularVelocity||0,acc:0},old:{pos:o(),vel:o(),acc:o(),angular:{pos:0,vel:0,acc:0}}},delete this.x,delete this.y,delete this.vx,delete this.vy,delete this.angle,delete this.angularVelocity,0===this.mass)throw"Error: Bodies must have non-zero mass";this.uid=e++,this.geometry=i.geometry("point")},setWorld:function(t){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t),this},accelerate:function(t){return"dynamic"===this.treatment&&this.state.acc.vadd(t),this},applyForce:function(t,e){if("dynamic"!==this.treatment)return this;var n,o=i.scratchpad(),r=o.vector();return e&&this.moi&&(n=this.state,r.clone(e),this.state.angular.acc-=r.cross(t)/this.moi),this.accelerate(r.clone(t).mult(1/this.mass)),o.done(),this},aabb:function(){var t=this.state.angular.pos,e=this.geometry.aabb(t);return e.x+=this.state.pos.x,e.y+=this.state.pos.y,e},recalc:function(){return this}})}(),function(){i.geometry=n("geometry",{init:function(t){this.options=i.util.options(),this.options(t),this._aabb=new i.aabb},aabb:function(){return i.aabb.clone(this._aabb)},getFarthestHullPoint:function(t,e){return e=e||i.vector(),e.set(0,0)},getFarthestCorePoint:function(t,e){return e=e||i.vector(),e.set(0,0)}})}(),i.geometry.isPolygonConvex=function(t){var e=i.scratchpad(),n=e.vector(),o=e.vector(),r=e.vector(),s=!0,a=!1,h=t.length;if(!t||!h)return!1;if(3>h)return e.done(),s;n.clone(t[0]).vsub(r.clone(t[h-1]));for(var l=1;h>=l;++l){if(o.clone(t[l%h]).vsub(r.clone(t[(l-1)%h])),a===!1)a=n.cross(o);else if(a>0^n.cross(o)>0){s=!1;break}o.swap(n)}return e.done(),s},i.geometry.getPolygonMOI=function(t){var e,n=i.scratchpad(),o=n.vector(),r=n.vector(),s=0,a=0,h=t.length;if(2>h)return n.done(),0;if(2===h)return e=r.clone(t[1]).distSq(o.clone(t[0])),n.done(),e/12;o.clone(t[0]);for(var l=1;h>l;++l)r.clone(t[l]),e=Math.abs(r.cross(o)),s+=e*(r.normSq()+r.dot(o)+o.normSq()),a+=e,o.swap(r);return n.done(),s/(6*a)},i.geometry.isPointInPolygon=function(t,e){var n=i.scratchpad(),o=n.vector().clone(t),r=n.vector(),s=n.vector(),a=0,h=e.length;if(2>h)return a=o.equals(r.clone(e[0])),n.done(),a;if(2===h)return a=o.angle(r.clone(e[0])),a+=o.angle(r.clone(e[1])),n.done(),Math.abs(a)===Math.PI;r.clone(e[0]).vsub(o);for(var l=1;h>=l;++l)s.clone(e[l%h]).vsub(o),a+=s.angle(r),r.swap(s);return n.done(),Math.abs(a)>1e-6},i.geometry.getPolygonArea=function(t){var e=i.scratchpad(),n=e.vector(),o=e.vector(),r=0,s=t.length;if(3>s)return e.done(),0;n.clone(t[s-1]);for(var a=0;s>a;++a)o.clone(t[a]),r+=n.cross(o),n.swap(o);return e.done(),r/2},i.geometry.getPolygonCentroid=function(t){var e,n=i.scratchpad(),o=n.vector(),r=n.vector(),s=i.vector(),a=t.length;if(2>a)return n.done(),i.vector(t[0]);if(2===a)return n.done(),i.vector((t[1].x+t[0].x)/2,(t[1].y+t[0].y)/2);o.clone(t[a-1]);for(var h=0;a>h;++h)r.clone(t[h]),e=o.cross(r),o.vadd(r).mult(e),s.vadd(o),o.swap(r);return e=1/(6*i.geometry.getPolygonArea(t)),n.done(),s.mult(e)},i.geometry.nearestPointOnLine=function(t,e,n){var o,r,s=i.scratchpad(),a=s.vector().clone(t),h=s.vector().clone(e).vsub(a),l=s.vector().clone(n).vsub(a).vsub(h);return l.equals(i.vector.zero)?(s.done(),i.vector(e)):(o=-l.dot(h)/l.normSq(),r=1-o,0>=r?(s.done(),i.vector(n)):0>=o?(s.done(),i.vector(e)):(a=i.vector(n).mult(o).vadd(h.clone(e).mult(r)),s.done(),a))},function(){var t={drag:0};i.integrator=n("integrator",{init:function(){this.options=i.util.options(t)},setWorld:function(t){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t),this},integrate:function(t,e){var i=this._world;return this.integrateVelocities(t,e),i&&i.emit("integrate:velocities",{bodies:t,dt:e}),this.integratePositions(t,e),i&&i.emit("integrate:positions",{bodies:t,dt:e}),this},connect:null,disconnect:null,integrateVelocities:function(){throw"The integrator.integrateVelocities() method must be overriden"},integratePositions:function(){throw"The integrator.integratePositions() method must be overriden"}})}(),function(){var t={meta:!1,metaRefresh:200,width:600,height:600};i.renderer=n("renderer",{init:function(n){var o="string"==typeof n.el?e.getElementById(n.el):n.el;this.options=i.util.extend({},t,n),this.el=o?o:e.body,this.drawMeta=i.util.throttle(i.util.bind(this.drawMeta,this),this.options.metaRefresh)},setWorld:function(t){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t),this},render:function(t,e){var i,n;this.beforeRender&&this.beforeRender(),this._world.emit("beforeRender",{renderer:this,bodies:t,meta:e}),this.options.meta&&this.drawMeta(e),this._interpolateTime=e.interpolateTime;for(var o=0,r=t.length;r>o;++o)i=t[o],n=i.view||(i.view=this.createView(i.geometry,i.styles)),i.hidden||this.drawBody(i,n);return this},createView:function(){throw"You must override the renderer.createView() method."},drawMeta:function(){throw"You must override the renderer.drawMeta() method."},drawBody:function(){throw"You must override the renderer.drawBody() method."}})}(),function(){var t=function o(t,e,i){for(var n,r,s=function(){return o(t,e,i)};n=t.shift();)if(r=n.apply(e,i),r&&r.then)return r.then(s)},e={timestep:1e3/120,maxIPF:16,webworker:!1,integrator:"verlet"},n=function r(t,e){return this instanceof r?void this.init(t,e):new r(t,e)};n.prototype=i.util.extend({},i.util.pubsub.prototype,{init:function(n,o){var r=this;(i.util.isFunction(n)||i.util.isArray(n))&&(o=n,n={}),this._meta={fps:0,ipf:0},this._bodies=[],this._behaviors=[],this._integrator=null,this._renderer=null,this._paused=!1,this._warp=1,this._time=0,this.options=i.util.options(e),this.options.onChange(function(t){r.timestep(t.timestep)}),this.options(n),this.add(i.integrator(this.options.integrator)),i.util.isFunction(o)?t([o],this,[this,i]):i.util.isArray(o)&&t(o,this,[this,i])},options:null,add:function(t){var e=0,i=t&&t.length||0,n=i?t[0]:t;if(!n)return this;do switch(n.type){case"behavior":this.addBehavior(n);break;case"integrator":this.integrator(n);break;case"renderer":this.renderer(n);break;case"body":this.addBody(n);break;default:throw'Error: failed to add item of unknown type "'+n.type+'" to world'}while(++e<i&&(n=t[e]));return this},remove:function(t){var e=0,i=t&&t.length||0,n=i?t[0]:t;if(!n)return this;do switch(n.type){case"behavior":this.removeBehavior(n);break;case"integrator":n===this._integrator&&this.integrator(null);break;case"renderer":n===this._renderer&&this.renderer(null);break;case"body":this.removeBody(n);break;default:throw'Error: failed to remove item of unknown type "'+n.type+'" from world'}while(++e<i&&(n=t[e]));return this},has:function(t){var e;if(!t)return!1;switch(t.type){case"behavior":e=this._behaviors;break;case"integrator":return this._integrator===t;case"renderer":return this._renderer===t;case"body":e=this._bodies;break;default:throw'Error: unknown type "'+t.type+'"'}return i.util.indexOf(e,t)>-1},integrator:function(t){return void 0===t?this._integrator:this._integrator===t?this:(this._integrator&&(this._integrator.setWorld(null),this.emit("remove:integrator",{integrator:this._integrator})),t&&(this._integrator=t,this._integrator.setWorld(this),this.emit("add:integrator",{integrator:this._integrator})),this)},renderer:function(t){return void 0===t?this._renderer:this._renderer===t?this:(this._renderer&&(this._renderer.setWorld(null),this.emit("remove:renderer",{renderer:this._renderer})),t&&(this._renderer=t,this._renderer.setWorld(this),this.emit("add:renderer",{renderer:this._renderer})),this)},timestep:function(t){return t?(this._dt=t,this._maxJump=t*this.options.maxIPF,this):this._dt},addBehavior:function(t){return this.has(t)?this:(t.setWorld(this),this._behaviors.push(t),this.emit("add:behavior",{behavior:t}),this)},getBehaviors:function(){return[].concat(this._behaviors)},removeBehavior:function(t){var e=this._behaviors;if(t)for(var i=0,n=e.length;n>i;++i)if(t===e[i]){e.splice(i,1),t.setWorld(null),this.emit("remove:behavior",{behavior:t});break}return this},addBody:function(t){return this.has(t)?this:(t.setWorld(this),this._bodies.push(t),this.emit("add:body",{body:t}),this)},getBodies:function(){return[].concat(this._bodies)},removeBody:function(t){var e=this._bodies;if(t)for(var i=0,n=e.length;n>i;++i)if(t===e[i]){e.splice(i,1),t.setWorld(null),this.emit("remove:body",{body:t});break}return this},findOne:function(t){var e=this,n="function"==typeof t?t:i.query(t);return i.util.find(e._bodies,n)||!1},find:function(t){var e=this,n="function"==typeof t?t:i.query(t);return i.util.filter(e._bodies,n)},iterate:function(t){this._integrator.integrate(this._bodies,t)},step:function(t){var e,n,o,r=this._time,s=this._warp,a=1/s,h=this._dt,l=h*a,c=this._maxJump*a,u=this._meta;if(this._paused||void 0===this._animTime)return this._animTime=t||this._animTime||i.util.ticker.now(),this._paused||this.emit("step",u),this;if(t=t||this._animTime+l,e=t-this._animTime,e>c&&(this._animTime=t-c,e=c),n=e*s,o=r+n-h,o>=r)for(;o>=r;)r+=h,this._animTime+=l,this._time=r,this.iterate(h);return u.fps=1e3/(t-this._lastTime),u.ipf=(n/h).toFixed(2),u.interpolateTime=h+o-r,this._lastTime=t,this.emit("step",u),this},warp:function(t){return void 0===t?this._warp:(this._warp=t||1,this)},render:function(){if(!this._renderer)throw"No renderer added to world";return this._renderer.render(this._bodies,this._meta),this.emit("render",{bodies:this._bodies,meta:this._meta,renderer:this._renderer}),this},pause:function(){return this._paused=!0,this.emit("pause"),this},unpause:function(){return this._paused=!1,this.emit("unpause"),this},isPaused:function(){return!!this._paused},destroy:function(){var t=this;t.pause(),this.emit("destroy"),t.off(!0),t.remove(t.getBodies()),t.remove(t.getBehaviors()),t.integrator(null),t.renderer(null)}}),i.world=n}(),i.integrator("verlet",function(t){return i.body.mixin({started:function(t){return void 0!==t&&(this._started=!0),!!this._started}}),{init:function(e){t.init.call(this,e)},integrateVelocities:function(t,e){for(var i,n=e*e,o=1-this.options.drag,r=null,s=0,a=t.length;a>s;++s)r=t[s],i=r.state,"static"!==r.treatment?(i.vel.equals(i.old.vel)&&r.started()?i.vel.clone(i.pos).vsub(i.old.pos):(i.old.pos.clone(i.pos).vsub(i.vel),i.vel.mult(e)),o&&i.vel.mult(o),i.vel.vadd(i.acc.mult(n)),i.vel.mult(1/e),i.old.vel.clone(i.vel),i.acc.zero(),i.angular.vel===i.old.angular.vel&&r.started()?i.angular.vel=i.angular.pos-i.old.angular.pos:(i.old.angular.pos=i.angular.pos-i.angular.vel,i.angular.vel*=e),i.angular.vel+=i.angular.acc*n,i.angular.vel/=e,i.old.angular.vel=i.angular.vel,i.angular.acc=0,r.started(!0)):(i.vel.zero(),i.acc.zero(),i.angular.vel=0,i.angular.acc=0)},integratePositions:function(t,e){for(var i,n=null,o=0,r=t.length;r>o;++o)n=t[o],i=n.state,"static"!==n.treatment&&(i.vel.mult(e),i.old.pos.clone(i.pos),i.pos.vadd(i.vel),i.vel.mult(1/e),i.old.vel.clone(i.vel),i.angular.vel*=e,i.old.angular.pos=i.angular.pos,i.angular.pos+=i.angular.vel,i.angular.vel/=e,i.old.angular.vel=i.angular.vel)}}}),i.geometry("point",function(){}),i.body("point",function(t){return{init:function(e){t.init.call(this,e),this.moi=0}}}),i.geometry("circle",function(t){var e={radius:1};return{init:function(n){t.init.call(this,n),this.options.defaults(e),this.options.onChange(function(t){this.radius=t.radius}),this.options(n),this._aabb=i.aabb(),this.radius=this.options.radius},aabb:function(){var t=this.radius;return this._aabb.hw!==t&&(this._aabb=i.aabb(-t,-t,t,t)),i.aabb.clone(this._aabb)},getFarthestHullPoint:function(t,e){return e=e||i.vector(),e.clone(t).normalize().mult(this.radius)},getFarthestCorePoint:function(t,e,n){return e=e||i.vector(),e.clone(t).normalize().mult(this.radius-n)}}}),i.geometry("convex-polygon",function(t){var e="Error: The vertices specified do not match that of a _convex_ polygon.",n={};return{init:function(e){var i=this;t.init.call(this,e),this.options.defaults(n),this.options.onChange(function(t){i.setVertices(t.vertices||[])}),this.options(e),i.setVertices(this.options.vertices||[])},setVertices:function(t){var n=i.scratchpad(),o=n.transform(),r=this.vertices=[];if(!i.geometry.isPolygonConvex(t))throw e;o.setRotation(0),o.setTranslation(i.geometry.getPolygonCentroid(t).negate());for(var s=0,a=t.length;a>s;++s)r.push(i.vector(t[s]).translate(o));return this._area=i.geometry.getPolygonArea(r),this._aabb=!1,n.done(),this},aabb:function(t){if(!t&&this._aabb)return i.aabb.clone(this._aabb);var e,n=i.scratchpad(),o=n.vector(),r=n.transform().setRotation(t||0),s=n.vector().set(1,0).rotateInv(r),a=n.vector().set(0,1).rotateInv(r),h=this.getFarthestHullPoint(s,o).proj(s),l=-this.getFarthestHullPoint(s.negate(),o).proj(s),c=this.getFarthestHullPoint(a,o).proj(a),u=-this.getFarthestHullPoint(a.negate(),o).proj(a);return e=i.aabb(l,u,h,c),t||(this._aabb=i.aabb.clone(e)),n.done(),e},getFarthestHullPoint:function(t,e,n){var o,r,s,a=this.vertices,h=a.length,l=2;if(e=e||i.vector(),2>h)return n&&(n.idx=0),e.clone(a[0]);if(r=a[0].dot(t),o=a[1].dot(t),2===h)return s=o>=r?1:0,n&&(n.idx=s),e.clone(a[s]);if(o>=r){for(;h>l&&o>=r;)r=o,o=a[l].dot(t),l++;return o>=r&&l++,s=l-2,n&&(n.idx=l-2),e.clone(a[s])}for(l=h;l>1&&r>=o;)l--,o=r,r=a[l].dot(t);return s=(l+1)%h,n&&(n.idx=s),e.clone(a[s])},getFarthestCorePoint:function(t,e,n){var o,r=i.scratchpad(),s=r.vector(),a=r.vector(),h=this.vertices,l=h.length,c=this._area>0,u={};return e=this.getFarthestHullPoint(t,e,u),s.clone(h[(u.idx+1)%l]).vsub(e).normalize().perp(c),a.clone(h[(u.idx-1+l)%l]).vsub(e).normalize().perp(!c),o=n/(1+s.dot(a)),e.vadd(s.vadd(a).mult(o)),r.done(),e
}}}),i.geometry("rectangle",function(t){var e={};return{init:function(i){var n=this;t.init.call(this,i),this.options.defaults(e),this.options.onChange(function(){n.width=n.options.width||1,n.height=n.options.height||1}),this.options(i)},aabb:function(t){if(!t)return i.aabb(this.width,this.height);var e=i.scratchpad(),n=e.vector(),o=e.transform().setRotation(t||0),r=e.vector().set(1,0).rotateInv(o),s=e.vector().set(0,1).rotateInv(o),a=this.getFarthestHullPoint(r,n).proj(r),h=-this.getFarthestHullPoint(r.negate(),n).proj(r),l=this.getFarthestHullPoint(s,n).proj(s),c=-this.getFarthestHullPoint(s.negate(),n).proj(s);return e.done(),i.aabb(h,c,a,l)},getFarthestHullPoint:function(t,e){e=e||new i.vector;var n=t.x,o=t.y;return n=0===n?0:0>n?.5*-this.width:.5*this.width,o=0===o?0:0>o?.5*-this.height:.5*this.height,e.set(n,o)},getFarthestCorePoint:function(t,e,i){var n,o;return e=this.getFarthestHullPoint(t,e),n=e.x,o=e.y,e.x=0===n?0:0>n?n+i:n-i,e.y=0===o?0:0>o?o+i:o-i,e}}}),i.body("circle",function(t){var e={radius:1};return{init:function(n){t.init.call(this,n),n=i.util.extend({},e,n),this.geometry=i.geometry("circle",{radius:n.radius}),this.recalc()},recalc:function(){t.recalc.call(this),this.moi=this.mass*this.geometry.radius*this.geometry.radius/2}}}),i.body("convex-polygon",function(t){var e={};return{init:function(n){t.init.call(this,n),n=i.util.extend({},e,n),this.geometry=i.geometry("convex-polygon",{vertices:n.vertices}),this.recalc()},recalc:function(){t.recalc.call(this),this.moi=i.geometry.getPolygonMOI(this.geometry.vertices)}}}),i.body("rectangle",function(t){var e={};return{init:function(n){t.init.call(this,n),n=i.util.extend({},e,n),this.geometry=i.geometry("rectangle",{width:n.width,height:n.height}),this.recalc()},recalc:function(){var e=this.geometry.width,i=this.geometry.height;t.recalc.call(this),this.moi=(e*e+i*i)*this.mass/12}}}),i.behavior("attractor",function(t){var e={pos:null,strength:1,order:2,max:!1,min:!1};return{init:function(n){var o=this;this._pos=new i.vector,t.init.call(this),this.options.defaults(e),this.options.onChange(function(t){o._maxDist=t.max===!1?1/0:t.max,o._minDist=t.min?t.min:10,o.position(t.pos)}),this.options(n)},position:function(t){var e=this;return t?(this._pos.clone(t),e):this._pos.values()},behave:function(){for(var t,e,n,o=this.getTargets(),r=this.options.order,s=this.options.strength,a=this._minDist,h=this._maxDist,l=i.scratchpad(),c=l.vector(),u=0,d=o.length;d>u;u++)t=o[u],c.clone(this._pos),c.vsub(t.state.pos),e=c.norm(),e>a&&h>e&&(n=s/Math.pow(e,r),t.accelerate(c.normalize().mult(n)));l.done()}}}),i.behavior("body-collision-detection",function(t){var e=[],n=function(t,n){var o=i.util.pairHash(t.uid,n.uid),r=e[o];return r||(r=e[o]=function(e){var o=i.scratchpad(),s=r.tA,a=r.tB,h=o.vector(),l=o.vector(),c=r.marginA,u=r.marginB;return r.useCore?(h=t.geometry.getFarthestCorePoint(e.rotateInv(s),h,c).transform(s),l=n.geometry.getFarthestCorePoint(e.rotate(s).rotateInv(a).negate(),l,u).transform(a)):(h=t.geometry.getFarthestHullPoint(e.rotateInv(s),h).transform(s),l=n.geometry.getFarthestHullPoint(e.rotate(s).rotateInv(a).negate(),l).transform(a)),e.negate().rotate(a),o.done({a:h.values(),b:l.values(),pt:h.vsub(l).values()})},r.tA=i.transform(),r.tB=i.transform()),r.useCore=!1,r.margin=0,r.tA.setTranslation(t.state.pos).setRotation(t.state.angular.pos),r.tB.setTranslation(n.state.pos).setRotation(n.state.angular.pos),r.bodyA=t,r.bodyB=n,r},o=function(t,e){var o,r,s,a=i.scratchpad(),h=a.vector(),l=a.vector(),c=!1,u=t.aabb(),d=Math.min(u.hw,u.hh),f=e.aabb(),p=Math.min(f.hw,f.hh);if(s=n(t,e),h.clone(t.state.pos).vsub(e.state.pos),r=i.gjk(s,h,!0),r.overlap){for(c={bodyA:t,bodyB:e},s.useCore=!0,s.marginA=0,s.marginB=0;r.overlap&&(s.marginA<d||s.marginB<p);)s.marginA<d&&(s.marginA+=1),s.marginB<p&&(s.marginB+=1),r=i.gjk(s,h);if(r.overlap||r.maxIterationsReached)return a.done(!1);o=Math.max(0,s.marginA+s.marginB-r.distance),c.overlap=o,c.norm=h.clone(r.closest.b).vsub(l.clone(r.closest.a)).normalize().values(),c.mtv=h.mult(o).values(),c.pos=h.clone(c.norm).mult(s.margin).vadd(l.clone(r.closest.a)).vsub(t.state.pos).values()}return a.done(c)},r=function(t,e){var n,o=i.scratchpad(),r=o.vector(),s=(o.vector(),!1);return r.clone(e.state.pos).vsub(t.state.pos),n=r.norm()-(t.geometry.radius+e.geometry.radius),r.equals(i.vector.zero)&&r.set(1,0),0>=n&&(s={bodyA:t,bodyB:e,norm:r.normalize().values(),mtv:r.mult(-n).values(),pos:r.normalize().mult(t.geometry.radius).values(),overlap:-n}),o.done(s)},s=function(t,e){return"static"!==t.treatment&&"kinematic"!==t.treatment||"static"!==e.treatment&&"kinematic"!==e.treatment?"circle"===t.geometry.name&&"circle"===e.geometry.name?r(t,e):o(t,e):!1},a={check:"collisions:candidates",channel:"collisions:detected"};return{init:function(e){t.init.call(this),this.options.defaults(a),this.options(e)},connect:function(t){this.options.check===!0?t.on("integrate:velocities",this.checkAll,this):t.on(this.options.check,this.check,this)},disconnect:function(t){this.options.check===!0?t.off("integrate:velocities",this.checkAll):t.off(this.options.check,this.check)},check:function(t){for(var e,n,o=t.candidates,r=this.getTargets(),a=[],h=0,l=o.length;l>h;++h)e=o[h],(r===this._world._bodies||i.util.indexOf(r,e.bodyA)>-1&&i.util.indexOf(r,e.bodyB)>-1)&&(n=s(e.bodyA,e.bodyB),n&&a.push(n));a.length&&this._world.emit(this.options.channel,{collisions:a})},checkAll:function(t){for(var e,i,n,o=this.getTargets(),r=(t.dt,[]),a=0,h=o.length;h>a;a++){e=o[a];for(var l=a+1;h>l;l++)i=o[l],n=s(e,i),n&&r.push(n)}r.length&&this._world.emit(this.options.channel,{collisions:r})}}}),i.behavior("body-impulse-response",function(t){var e={check:"collisions:detected"};return{init:function(i){t.init.call(this),this.options.defaults(e),this.options(i)},applyTo:!1,connect:function(t){t.on(this.options.check,this.respond,this)},disconnect:function(t){t.off(this.options.check,this.respond)},collideBodies:function(t,e,n,o,r,s){var a="static"===t.treatment||"kinematic"===t.treatment,h="static"===e.treatment||"kinematic"===e.treatment,l=i.scratchpad(),c=l.vector().clone(r);if(a&&h)return void l.done();a?e.state.pos.vadd(c):h?t.state.pos.vsub(c):(c.mult(.5),t.state.pos.vsub(c),e.state.pos.vadd(c));var u,d,f,p=a?0:1/t.moi,v=h?0:1/e.moi,y=a?0:1/t.mass,m=h?0:1/e.mass,g=s?0:t.restitution*e.restitution,b=t.cof*e.cof,_=l.vector().clone(n),w=l.vector().clone(_).perp(),x=l.vector().clone(o),P=l.vector().clone(o).vadd(t.state.pos).vsub(e.state.pos),C=l.vector(),A=t.state.angular.vel,I=e.state.angular.vel,k=l.vector().clone(e.state.vel).vadd(C.clone(P).perp().mult(I)).vsub(t.state.vel).vsub(C.clone(x).perp().mult(A)),B=x.proj(_),T=x.proj(w),S=P.proj(_),j=P.proj(w),F=k.proj(_),M=k.proj(w),O=!1;return F>=0?void l.done():(p=1/0===p?0:p,v=1/0===v?0:v,u=-((1+g)*F)/(y+m+p*T*T+v*j*j),a?(e.state.vel.vadd(_.mult(u*m)),e.state.angular.vel-=u*v*j):h?(t.state.vel.vsub(_.mult(u*y)),t.state.angular.vel+=u*p*T):(e.state.vel.vadd(_.mult(u*m)),e.state.angular.vel-=u*v*j,t.state.vel.vsub(_.mult(y*e.mass)),t.state.angular.vel+=u*p*T),b&&M&&(f=M/(y+m+p*B*B+v*S*S),O?u=f:(d=0>M?-1:1,u*=d*b,u=1===d?Math.min(u,f):Math.max(u,f)),a?(e.state.vel.vsub(w.mult(u*m)),e.state.angular.vel-=u*v*S):h?(t.state.vel.vadd(w.mult(u*y)),t.state.angular.vel+=u*p*B):(e.state.vel.vsub(w.mult(u*m)),e.state.angular.vel-=u*v*S,t.state.vel.vadd(w.mult(y*e.mass)),t.state.angular.vel+=u*p*B)),void l.done())},respond:function(t){for(var e,n=this,o=i.util.shuffle(t.collisions),r=0,s=o.length;s>r;++r)e=o[r],n.collideBodies(e.bodyA,e.bodyB,e.norm,e.pos,e.mtv)}}}),i.behavior("constant-acceleration",function(t){var e={acc:{x:0,y:4e-4}};return{init:function(n){t.init.call(this),this.options.defaults(e),this.options(n),this._acc=i.vector(),this.setAcceleration(this.options.acc),delete this.options.acc},setAcceleration:function(t){return this._acc.clone(t),this},behave:function(){for(var t=this.getTargets(),e=0,i=t.length;i>e;++e)t[e].accelerate(this._acc)}}}),i.behavior("edge-collision-detection",function(t){var e=function(t,e,n){var o,r=t.aabb(),s=i.scratchpad(),a=s.transform(),h=s.vector(),l=s.vector(),c=!1,u=[];return o=r.x+r.hw-e.max.x,o>=0&&(h.set(1,0).rotateInv(a.setRotation(t.state.angular.pos)),c={bodyA:t,bodyB:n,overlap:o,norm:{x:1,y:0},mtv:{x:o,y:0},pos:t.geometry.getFarthestHullPoint(h,l).rotate(a).values()},u.push(c)),o=r.y+r.hh-e.max.y,o>=0&&(h.set(0,1).rotateInv(a.setRotation(t.state.angular.pos)),c={bodyA:t,bodyB:n,overlap:o,norm:{x:0,y:1},mtv:{x:0,y:o},pos:t.geometry.getFarthestHullPoint(h,l).rotate(a).values()},u.push(c)),o=e.min.x-(r.x-r.hw),o>=0&&(h.set(-1,0).rotateInv(a.setRotation(t.state.angular.pos)),c={bodyA:t,bodyB:n,overlap:o,norm:{x:-1,y:0},mtv:{x:-o,y:0},pos:t.geometry.getFarthestHullPoint(h,l).rotate(a).values()},u.push(c)),o=e.min.y-(r.y-r.hh),o>=0&&(h.set(0,-1).rotateInv(a.setRotation(t.state.angular.pos)),c={bodyA:t,bodyB:n,overlap:o,norm:{x:0,y:-1},mtv:{x:0,y:-o},pos:t.geometry.getFarthestHullPoint(h,l).rotate(a).values()},u.push(c)),s.done(),u},n=function(t,i,n){return e(t,i,n)},o={aabb:null,restitution:.99,cof:1,channel:"collisions:detected"};return{init:function(e){t.init.call(this),this.options.defaults(o),this.options(e),this.setAABB(this.options.aabb),this.restitution=this.options.restitution,this.body=i.body("point",{treatment:"static",restitution:this.options.restitution,cof:this.options.cof})},setAABB:function(t){if(!t)throw"Error: aabb not set";return this._edges={min:{x:t.x-t.hw,y:t.y-t.hh},max:{x:t.x+t.hw,y:t.y+t.hh}},this},connect:function(t){t.on("integrate:velocities",this.checkAll,this)},disconnect:function(t){t.off("integrate:velocities",this.checkAll)},checkAll:function(t){for(var e,i,o=this.getTargets(),r=(t.dt,[]),s=this._edges,a=this.body,h=0,l=o.length;l>h;h++)e=o[h],"dynamic"===e.treatment&&(i=n(e,s,a),i&&r.push.apply(r,i));r.length&&this._world.emit(this.options.channel,{collisions:r})}}}),i.behavior("interactive",function(t){if(!e)return{};var n={el:null,moveThrottle:10,minVel:{x:-5,y:-5},maxVel:{x:5,y:5}},o=function(t){var e=0,i=0;if(t.offsetParent)do e+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);return{left:e,top:i}},r=function(t){var e=o(t.target),i=t.changedTouches&&t.changedTouches[0]||t,n=i.pageX-e.left,r=i.pageY-e.top;return{x:n,y:r}};return{init:function(o){var s,a,h=this;if(t.init.call(this),this.options.defaults(n),this.options(o),this.mousePos=new i.vector,this.mousePosOld=new i.vector,this.offset=new i.vector,this.el="string"==typeof this.options.el?e.getElementById(this.options.el):this.options.el,!this.el)throw"No DOM element specified";var l=function(t){var e,n=r(t);h._world&&(e=h._world.findOne({$at:new i.vector(n.x,n.y)}),e?(s=e.treatment,e.treatment="kinematic",e.state.vel.zero(),e.state.angular.vel=0,h.body=e,h.mousePos.clone(n),h.offset.clone(n).vsub(e.state.pos),n.body=e,h._world.emit("interact:grab",n)):h._world.emit("interact:poke",n))},c=i.util.throttle(function(t){var e=r(t);h.body&&(a=i.util.ticker.now(),h.mousePosOld.clone(h.mousePos),h.mousePos.set(e.x,e.y),e.body=h.body),h._world.emit("interact:move",e)},h.options.moveThrottle),u=function(t){var e=r(t),n=Math.max(i.util.ticker.now()-a,h.options.moveThrottle);h.mousePos.set(e.x,e.y),h.body&&(h.body.treatment=s,h.body.state.vel.clone(h.mousePos).vsub(h.mousePosOld).mult(1/n),h.body.state.vel.clamp(h.options.minVel,h.options.maxVel),h.body=!1),h._world&&h._world.emit("interact:release",e)};this.el.addEventListener("mousedown",l),this.el.addEventListener("touchstart",l),this.el.addEventListener("mousemove",c),this.el.addEventListener("touchmove",c),this.el.addEventListener("mouseup",u),this.el.addEventListener("touchend",u)},connect:function(t){t.on("integrate:positions",this.behave,this)},disconnect:function(t){t.off("integrate:positions",this.behave)},behave:function(t){var e,i=this,n=Math.max(t.dt,i.options.moveThrottle);i.body&&(e=i.body.state,e.vel.clone(i.mousePos).vsub(i.offset).vsub(e.pos).mult(1/n))}}}),i.behavior("newtonian",function(t){var e={strength:1,max:!1,min:!1};return{init:function(i){var n=this;t.init.call(this),this.options.defaults(e),this.options.onChange(function(t){n._maxDistSq=t.max===!1?1/0:t.max*t.max,n._minDistSq=t.min?t.min*t.min:100*t.strength}),this.options(i)},behave:function(){for(var t,e,n,o,r=this.getTargets(),s=this.options.strength,a=this._minDistSq,h=this._maxDistSq,l=i.scratchpad(),c=l.vector(),u=0,d=r.length;d>u;u++){t=r[u];for(var f=u+1;d>f;f++)e=r[f],c.clone(e.state.pos),c.vsub(t.state.pos),n=c.normSq(),n>a&&h>n&&(o=s/n,t.accelerate(c.normalize().mult(o*e.mass)),e.accelerate(c.mult(t.mass/e.mass).negate()))}l.done()}}}),i.behavior("sweep-prune",function(t){var e=1,n=function(){return e++},o={x:0,y:1},r=2,s=i.util.pairHash;return{init:function(e){t.init.call(this),this.options.defaults({channel:"collisions:candidates"}),this.options(e),this.encounters=[],this.candidates=[],this.clear()},clear:function(){this.tracked=[],this.pairs=[],this.intervalLists=[];for(var t=0;r>t;++t)this.intervalLists[t]=[]},connect:function(t){t.on("add:body",this.trackBody,this),t.on("remove:body",this.untrackBody,this),t.on("integrate:velocities",this.sweep,this);for(var e=t.getBodies(),i=0,n=e.length;n>i;++i)this.trackBody({body:e[i]})},disconnect:function(t){t.off("add:body",this.trackBody),t.off("remove:body",this.untrackBody),t.off("integrate:velocities",this.sweep),this.clear()},broadPhase:function(){return this.updateIntervals(),this.sortIntervalLists(),this.checkOverlaps()},sortIntervalLists:function(){for(var t,e,i,n,o,s,a,h,l,c=0;r>c;++c)for(t=this.intervalLists[c],i=0,e=t.length,l=c;++i<e;){for(o=t[i],s=o.val.get(l),n=i,a=t[n-1],h=a&&a.val.get(l);n>0&&(h>s||h===s&&a.type&&!o.type);)t[n]=a,n--,a=t[n-1],h=a&&a.val.get(l);t[n]=o}},getPair:function(t,e,i){var n=s(t.id,e.id);if(n===!1)return null;var o=this.pairs[n];if(!o){if(!i)return null;o=this.pairs[n]={bodyA:t.body,bodyB:e.body,flag:1}}return o},checkOverlaps:function(){var t,e,i,n,s,a,h,l,c,u=1<<o.z+1<<o.y+1<<o.x+1,d=this.encounters,f=0,p=this.candidates;d.length=p.length=0;for(var v=0;r>v;++v)for(t=0===v,s=this.intervalLists[v],h=0,a=s.length;a>h;h++)if(n=s[h],e=n.tracker,n.type)for(l=f,l=f-1;l>=0;l--)i=d[l],i===e?(f-1>l?d[l]=d.pop():d.pop(),f--):(c=this.getPair(e,i,t),c&&(c.flag>u&&(c.flag=1),c.flag=c.flag<<v+1,c.flag===u&&p.push(c)));else f=d.push(e);return p},updateIntervals:function(){for(var t,e,n,o=i.scratchpad(),r=o.vector(),s=o.vector(),a=this.tracked,h=a.length;--h>=0;)t=a[h],e=t.interval,r.clone(t.body.state.pos),n=t.body.aabb(),s.set(n.hw,n.hh),e.min.val.clone(r).vsub(s),e.max.val.clone(r).vadd(s);o.done()},trackBody:function(t){var e=t.body,o={id:n(),body:e},s={min:{type:!1,val:i.vector(),tracker:o},max:{type:!0,val:i.vector(),tracker:o}};o.interval=s,this.tracked.push(o);for(var a=0;r>a;++a)this.intervalLists[a].push(s.min,s.max)},untrackBody:function(t){for(var e,i,n,o,s=t.body,a=this.tracked,h=0,l=a.length;l>h;++h)if(n=a[h],n.body===s){a.splice(h,1);for(var c=0;r>c;++c){o=0,e=this.intervalLists[c];for(var u=0,d=e.length;d>u;++u)if(i=e[u],i===n.interval.min||i===n.interval.max){if(e.splice(u,1),u--,l--,o>0)break;o++}}break}},sweep:function(){var t,e=this;t=e.broadPhase(),t.length&&this._world.emit(this.options.channel,{candidates:t})}}}),i.behavior("verlet-constraints",function(t){var e=2*Math.PI,n={iterations:2};return{init:function(e){t.init.call(this),this.options.defaults(n),this.options(e),this._distanceConstraints=[],this._angleConstraints=[]},connect:function(t){var e=t.integrator();if(e&&e.name.indexOf("verlet")<0)throw'The rigid constraint manager needs a world with a "verlet" compatible integrator.';t.on("integrate:positions",this.resolve,this)},disconnect:function(t){t.off("integrate:positions",this.resolve)},drop:function(){return this._distanceConstraints=[],this._angleConstraints=[],this},distanceConstraint:function(t,e,n,o){var r;return t&&e?(r={id:i.util.uniqueId("dis-constraint"),type:"dis",bodyA:t,bodyB:e,stiffness:n||.5,targetLength:o||e.state.pos.dist(t.state.pos)},r.targetLengthSq=r.targetLength*r.targetLength,this._distanceConstraints.push(r),r):!1},angleConstraint:function(t,e,n,o,r){var s;return t&&e?(s={id:i.util.uniqueId("ang-constraint"),type:"ang",bodyA:t,bodyB:e,bodyC:n,stiffness:o||.5,targetAngle:r||e.state.pos.angle2(t.state.pos,n.state.pos)},this._angleConstraints.push(s),s):!1},remove:function(t){var e,n,o,r,s;if(o=i.util.isObject(t),n=o?t.type:t.substr(0,3),e="ang"===n?this._angleConstraints:this._distanceConstraints,o){for(r=0,s=e.length;s>r;++r)if(e[r]===t)return e.splice(r,1),this}else for(r=0,s=e.length;s>r;++r)if(e[r].id===t)return e.splice(r,1),this;return this},resolveAngleConstraints:function(t){for(var n,o,r,s,a=this._angleConstraints,h=i.scratchpad(),l=h.transform(),c=0,u=a.length;u>c;++c)n=a[c],o=n.bodyB.state.pos.angle2(n.bodyA.state.pos,n.bodyC.state.pos),r=o-n.targetAngle,r&&(r<=-Math.PI?r+=e:r>=Math.PI&&(r-=e),l.setTranslation(n.bodyB.state.pos),r*=-t*n.stiffness,"dynamic"===n.bodyA.treatment&&"dynamic"===n.bodyB.treatment&&"dynamic"===n.bodyC.treatment&&(s=1/(n.bodyA.mass+n.bodyB.mass+n.bodyC.mass)),"dynamic"===n.bodyA.treatment&&(o="dynamic"===n.bodyB.treatment&&"dynamic"===n.bodyC.treatment?r*(n.bodyB.mass+n.bodyC.mass)*s:"dynamic"!==n.bodyB.treatment?r*n.bodyC.mass/(n.bodyC.mass+n.bodyA.mass):r*n.bodyB.mass/(n.bodyB.mass+n.bodyA.mass),l.setRotation(o),n.bodyA.state.pos.translateInv(l),n.bodyA.state.pos.rotate(l),n.bodyA.state.pos.translate(l)),"dynamic"===n.bodyC.treatment&&(o="dynamic"===n.bodyA.treatment&&"dynamic"===n.bodyB.treatment?-r*(n.bodyB.mass+n.bodyA.mass)*s:"dynamic"!==n.bodyB.treatment?-r*n.bodyA.mass/(n.bodyC.mass+n.bodyA.mass):-r*n.bodyB.mass/(n.bodyB.mass+n.bodyC.mass),l.setRotation(o),n.bodyC.state.pos.translateInv(l),n.bodyC.state.pos.rotate(l),n.bodyC.state.pos.translate(l)),"dynamic"===n.bodyB.treatment&&(o="dynamic"===n.bodyA.treatment&&"dynamic"===n.bodyC.treatment?r*(n.bodyA.mass+n.bodyC.mass)*s:"dynamic"!==n.bodyA.treatment?r*n.bodyC.mass/(n.bodyC.mass+n.bodyB.mass):r*n.bodyA.mass/(n.bodyA.mass+n.bodyC.mass),l.setRotation(o).setTranslation(n.bodyA.state.pos),n.bodyB.state.pos.translateInv(l),n.bodyB.state.pos.rotate(l),n.bodyB.state.pos.translate(l),l.setTranslation(n.bodyC.state.pos),n.bodyB.state.pos.translateInv(l),n.bodyB.state.pos.rotateInv(l),n.bodyB.state.pos.translate(l)));h.done()},resolveDistanceConstraints:function(t){for(var e,n,o,r,s=this._distanceConstraints,a=i.scratchpad(),h=a.vector(),l=0,c=s.length;c>l;++l)e=s[l],h.clone(e.bodyB.state.pos).vsub(e.bodyA.state.pos),n=h.normSq()||1e-4*Math.random(),o=t*e.stiffness*(n-e.targetLengthSq)/n,h.mult(o),r="dynamic"!==e.bodyA.treatment||"dynamic"!==e.bodyB.treatment?1:e.bodyB.mass/(e.bodyA.mass+e.bodyB.mass),"dynamic"===e.bodyA.treatment&&("dynamic"===e.bodyB.treatment&&h.mult(r),e.bodyA.state.pos.vadd(h),"dynamic"===e.bodyB.treatment&&h.mult(1/r)),"dynamic"===e.bodyB.treatment&&("dynamic"===e.bodyA.treatment&&h.mult(1-r),e.bodyB.state.pos.vsub(h));a.done()},shuffleConstraints:function(){this._distanceConstraints=i.util.shuffle(this._distanceConstraints),this._angleConstraints=i.util.shuffle(this._angleConstraints)},resolve:function(){for(var t=this.options.iterations,e=1/t,i=0;t>i;i++)this.resolveDistanceConstraints(e),this.resolveAngleConstraints(e)},getConstraints:function(){return{distanceConstraints:[].concat(this._distanceConstraints),angleConstraints:[].concat(this._angleConstraints)}}}}),i.integrator("improved-euler",function(t){return{init:function(e){t.init.call(this,e)},integrateVelocities:function(t,e){for(var i,n=1-this.options.drag,o=null,r=0,s=t.length;s>r;++r)o=t[r],i=o.state,"static"!==o.treatment?(i.old.vel.clone(i.vel),i.old.acc.clone(i.acc),i.vel.vadd(i.acc.mult(e)),n&&i.vel.mult(n),i.acc.zero(),i.old.angular.vel=i.angular.vel,i.angular.vel+=i.angular.acc*e,i.angular.acc=0):(i.vel.zero(),i.acc.zero(),i.angular.vel=0,i.angular.acc=0)},integratePositions:function(t,e){for(var n,o=.5*e*e,r=null,s=i.scratchpad(),a=s.vector(),h=0,l=t.length;l>h;++h)r=t[h],n=r.state,"static"!==r.treatment&&(n.old.pos.clone(n.pos),a.clone(n.old.vel),n.pos.vadd(a.mult(e)).vadd(n.old.acc.mult(o)),n.old.acc.zero(),n.old.angular.pos=n.angular.pos,n.angular.pos+=n.old.angular.vel*e+n.old.angular.acc*o,n.old.angular.acc=0);s.done()}}}),i.renderer("canvas",function(t){if(!e)return{};var n=2*Math.PI,o=function(t,i){var n=e.createElement(t||"div");return i&&(n.innerHTML=i),n},r={white:"#fff",violet:"#542437",blue:"#53777A"},s={debug:!1,metaEl:null,styles:{circle:{strokeStyle:r.blue,lineWidth:1,fillStyle:r.blue,angleIndicator:r.white},"convex-polygon":{strokeStyle:r.violet,lineWidth:1,fillStyle:r.violet,angleIndicator:r.white}},offset:{x:0,y:0}},a=function(t,e){return i.util.isPlainObject(e)?i.util.extend({},t,e,a):void 0!==e?e:t};return{init:function(n){if(t.init.call(this,n),this.options=i.util.extend({},s,this.options,a),this.options.offset=i.vector(this.options.offset),this.hiddenCanvas=e.createElement("canvas"),this.hiddenCanvas.width=this.hiddenCanvas.height=100,!this.hiddenCanvas.getContext)throw"Canvas not supported";this.hiddenCtx=this.hiddenCanvas.getContext("2d");var r=this.el;if("CANVAS"!==r.nodeName.toUpperCase()&&(r=e.createElement("canvas"),this.el.appendChild(r),"string"==typeof this.options.el&&this.el===e.body&&(r.id=this.options.el),this.el=r),this.ctx=r.getContext("2d"),this.els={},this.options.meta){var h=this.options.metaEl||o();h.className="pjs-meta",this.els.fps=o("span"),this.els.ipf=o("span"),h.appendChild(o("span","fps: ")),h.appendChild(this.els.fps),h.appendChild(o("br")),h.appendChild(o("span","ipf: ")),h.appendChild(this.els.ipf),r.parentNode.insertBefore(h,r)}this._layers={},this.addLayer("main",this.el),this.resize(this.options.width,this.options.height)},layer:function(t){return t in this._layers?this._layers[t]:null},addLayer:function(t,n,o){var r=this,s=[],a=i.util.extend({},this.options.styles),h={id:t,el:n||e.createElement("canvas"),options:i.util.options({width:this.el.width,height:this.el.height,manual:!1,autoResize:!0,follow:null,offset:null,scale:1,zIndex:1})(o)};if(t in this._layers)throw'Layer "'+t+'" already added.';return this.el.parentNode.insertBefore(h.el,this.el),h.el.style.position="absolute",h.el.style.zIndex=h.options.zIndex,h.el.className+=" pjs-layer-"+h.id,h.ctx=h.el.getContext("2d"),h.ctx.scale(1,1),h.el.width=h.options.width,h.el.height=h.options.height,h.bodies=s,h.reset=function(t){return s=t||[],h},h.addToStack=function(t){return i.util.isArray(t)?s.push.apply(s,t):s.push(t),h},h.removeFromStack=function(t){var e,n;if(i.util.isArray(t))for(e=0,n=t.length;n>e;++e)h.removeFromStack(t[e]);else e=i.util.indexOf(s,t),e>-1&&s.splice(e,1);return h},h.render=function(t){var e,n,o,l=i.scratchpad(),c=l.vector().set(0,0),u=h.options.scale,d=s.length,f=d||"main"!==h.id?s:r._world._bodies;if(h.options.manual)return l.done(),h;for(h.options.offset&&("center"===h.options.offset?c.add(.5*h.el.width,.5*h.el.height).mult(1/u):c.vadd(h.options.offset).mult(1/u)),h.options.follow&&c.vsub(h.options.follow.state.pos),t!==!1&&h.ctx.clearRect(0,0,h.el.width,h.el.height),1!==u&&(h.ctx.save(),h.ctx.scale(u,u)),o=0,d=f.length;d>o;++o)e=f[o],e.hidden||(n=e.view||(e.view=r.createView(e.geometry,e.styles||a[e.geometry.name])),r.drawBody(e,e.view,h.ctx,c));return 1!==u&&h.ctx.restore(),l.done(),h},this._layers[t]=h,h},removeLayer:function(t){var e=t.id?t.id:t,i=this._layers[e].el;return i!==this.el&&i.parentNode.removeChild(i),delete this._layers[e],this},resize:function(t,e){var i;for(var n in this._layers)i=this._layers[n],i.options.autoResize&&(i.el.width=t,i.el.height=e);return this},setStyle:function(t,e){e=e||this.ctx,i.util.isObject(t)?(t.strokeStyle=t.lineWidth?t.strokeStyle:"rgba(0,0,0,0)",i.util.extend(e,t)):(e.fillStyle=e.strokeStyle=t,e.lineWidth=1)},drawCircle:function(t,e,i,o,r){r=r||this.ctx,r.beginPath(),this.setStyle(o,r),r.arc(t,e,i,0,n,!1),r.closePath(),r.stroke(),r.fill()},drawPolygon:function(t,e,i){var n=t[0],o=n.x,r=n.y,s=t.length;i=i||this.ctx,i.beginPath(),this.setStyle(e,i),i.moveTo(o,r);for(var a=1;s>a;++a)n=t[a],o=n.x,r=n.y,i.lineTo(o,r);s>2&&i.closePath(),i.stroke(),i.fill()},drawRect:function(t,e,i,n,o,r){var s=.5*i,a=.5*n;r=r||this.ctx,this.setStyle(o,r),r.beginPath(),r.rect(t-s,e-a,i,n),r.closePath(),r.stroke(),r.fill()},drawLine:function(t,e,i,n){var o=t.x,r=t.y;n=n||this.ctx,n.beginPath(),this.setStyle(i,n),n.moveTo(o,r),o=e.x,r=e.y,n.lineTo(o,r),n.stroke(),n.fill()},createView:function(t,e){var i,n=t.aabb(),o=n.hw+Math.abs(n.x),r=n.hh+Math.abs(n.y),s=o+1,a=r+1,h=this.hiddenCtx,l=this.hiddenCanvas,c=t.name;return e=e||this.options.styles[c]||{},e.src?(i=new Image,i.src=e.src,e.width&&(i.width=e.width),e.height&&(i.height=e.height),i):(s+=0|e.lineWidth,a+=0|e.lineWidth,l.width=2*o+2+(0|2*e.lineWidth),l.height=2*r+2+(0|2*e.lineWidth),h.save(),h.translate(s,a),"circle"===c?this.drawCircle(0,0,t.radius,e,h):"convex-polygon"===c?this.drawPolygon(t.vertices,e,h):"rectangle"===c&&this.drawRect(0,0,t.width,t.height,e,h),e.angleIndicator&&(h.beginPath(),this.setStyle(e.angleIndicator,h),h.moveTo(0,0),h.lineTo(o,0),h.closePath(),h.stroke()),h.restore(),i=new Image(l.width,l.height),i.src=l.toDataURL("image/png"),i)},drawMeta:function(t){this.els.fps.innerHTML=t.fps.toFixed(2),this.els.ipf.innerHTML=t.ipf},drawBody:function(t,e,i,n){var o,r,s,a,h=t.state.pos,l=t.state.vel,c=this._interpolateTime||0;n=n||this.options.offset,i=i||this.ctx,o=h.x+n.x+l.x*c,r=h.y+n.y+l.y*c,s=t.state.angular.pos+t.state.angular.vel*c,i.save(),i.translate(o,r),i.rotate(s),i.drawImage(e,-e.width/2,-e.height/2),i.restore(),this.options.debug&&(a=t.aabb(),this.drawRect(a.x,a.y,2*a.hw,2*a.hh,"rgba(0, 0, 255, 0.3)"),t._debugView=t._debugView||this.createView(t.geometry,"rgba(255, 0, 0, 0.5)"),i.save(),i.translate(h.x+n.x,h.y+n.y),i.rotate(t.state.angular.pos),i.drawImage(t._debugView,.5*-t._debugView.width,.5*-t._debugView.height),i.restore())},render:function(t,e){this._world.emit("beforeRender",{renderer:this,meta:e}),this.options.meta&&this.drawMeta(e),this._interpolateTime=e.interpolateTime;for(var i in this._layers)this._layers[i].render();return this}}}),i.renderer("dom",function(t){if(!e)return{};var i={},n=e.createElement("div"),o=function(t){return t.replace(/(?:^|\s)\w/g,function(t){return t.toUpperCase()})},r=function(t){if(i[t])return i[t];for(var e,r=["Webkit","Moz","Ms","O"],s=0,a=r.length;a>s;++s)if(e=r[s]+o(t),e in n.style)return i[t]=e;return e in n.style?i[t]=t:!1},s="pjs-",a="px",h=r("transform"),l=function(t,i){var n=e.createElement(t||"div");return i&&(n.innerHTML=i),n};return{init:function(e){t.init.call(this,e);var i=this.el;if(i.style.position="relative",i.style.overflow="hidden",i.style[h]="translateZ(0)",i.style.width=this.options.width+a,i.style.height=this.options.height+a,this.els={},e.meta){var n=l();n.className="pjs-meta",this.els.fps=l("span"),this.els.ipf=l("span"),n.appendChild(l("span","fps: ")),n.appendChild(this.els.fps),n.appendChild(l("br")),n.appendChild(l("span","ipf: ")),n.appendChild(this.els.ipf),i.appendChild(n)}},circleProperties:function(t,e){var i=e.aabb();t.style.width=2*i.hw+a,t.style.height=2*i.hh+a,t.style.marginLeft=-i.hw+a,t.style.marginTop=-i.hh+a},rectangleProperties:function(t,e){var i=e.aabb();t.style.width=2*i.hw+a,t.style.height=2*i.hh+a,t.style.marginLeft=-i.hw+a,t.style.marginTop=-i.hh+a},createView:function(t){var e=l(),i=t.name+"Properties";return e.className=s+t.name,e.style.position="absolute",e.style.top="0px",e.style.left="0px",this[i]&&this[i](e,t),this.el.appendChild(e),e},connect:function(t){t.on("add:body",this.attach,this),t.on("remove:body",this.detach,this)},disconnect:function(t){t.off("add:body",this.attach),t.off("remove:body",this.detach)},detach:function(t){var e=t.nodeType&&t||t.body&&t.body.view,i=e&&e.parentNode;return e&&i&&i.removeChild(e),this},attach:function(t){var e=t.nodeType&&t||t.body&&t.body.view;return e&&this.el.appendChild(e),this},drawMeta:function(t){this.els.fps.innerHTML=t.fps.toFixed(2),this.els.ipf.innerHTML=t.ipf},drawBody:function(t,e){var i,n,o,r=t.state.pos,s=t.state.vel,a=this._interpolateTime;i=r.x+s.x*a,n=r.y+s.y*a,o=t.state.angular.pos+t.state.angular.vel*a,e.style[h]="translate("+i+"px,"+n+"px) rotate("+o+"rad)"}}}),i.renderer("pixi",function(t){if(!e)return{};2*Math.PI;var n={debug:!1,metaEl:null,offset:{x:0,y:0},styles:{color:"0x66FF99",point:"0xE8900C",circle:{strokeStyle:"0xE8900C",lineWidth:3,fillStyle:"0xD5DE4C",angleIndicator:"0xE8900C"},"convex-polygon":{strokeStyle:"0xE8900C",lineWidth:3,fillStyle:"0xD5DE4C",angleIndicator:"0xE8900C"}}},o=function(t,e){return i.util.isPlainObject(e)?i.util.extend({},t,e,o):void 0!==e?e:t};return{init:function(r){if("undefined"==typeof PIXI)throw"PIXI obj not present - cannot continue ";t.init.call(this,r),this.options=i.util.extend({},n,this.options,o),this.options.offset=i.vector(this.options.offset),this.stage=new PIXI.Stage(this.options.styles.color),this.renderer=new PIXI.autoDetectRenderer(this.options.width,this.options.height),this.meta={},"CANVAS"===this.el.nodeName?this.renderer=new PIXI.autoDetectRenderer(this.options.width,this.options.height,this.el):(this.renderer=new PIXI.autoDetectRenderer(this.options.width,this.options.height),null!==this.el?this.el.appendChild(this.renderer.view):e.body.appendChild(this.renderer.view))},loadSpriteSheets:function(t,e){if(!i.util.isArray(t))throw"Spritesheets must be defined in arrays";var n=this,o=new PIXI.AssetLoader(t);return o.load(),o.on("onComplete",function(){n.assetsLoaded=!0,e()}),n},drawBody:function(t,e){var i,n,o,r=t.state.pos,s=t.state.vel,a=this._interpolateTime||0;i=r.x+s.x*a,n=r.y+s.y*a,o=t.state.angular.pos+t.state.angular.vel*a,e.position.x=i,e.position.y=n,e.rotation=o},render:function(e,i){t.render.call(this,e,i),this.renderer.render(this.stage)},createCircle:function(t,e,i,n){var o=new PIXI.Graphics;return o.beginFill(n.fillStyle),o.lineStyle(n.lineWidth,n.strokeStyle),o.drawCircle(t,e,i),o.pivot.x=t/2+i/2,o.pivot.y=e/2+i/2,o},createPolygon:function(t,e){var i=t[0],n=i.x,o=i.y,r=t.length,s={x:n,y:o},a=new PIXI.Graphics;a.beginFill(e.fillStyle),a.lineStyle(e.lineWidth,e.strokeStyle),a.moveTo(n,o);for(var h=1;r>h;++h)i=t[h],n=i.x,o=i.y,a.lineTo(n,o);return r>2&&a.lineTo(s.x,s.y),a.endFill(),a},createLine:function(t,e,i){var n=t.x,o=t.y,r=new PIXI.Graphics;return r.beginFill(i.fillStyle),r.lineStyle(i.lineWidth,i.strokeStyle),r.moveTo(n,o),n=e.x,o=e.y,r.lineTo(n,o),r.endFill(),r},createView:function(t){var e=null,i=t.aabb(),n=i.hw+Math.abs(i.x),o=i.hh+Math.abs(i.y),r=n+1,s=o+1,a=t.name,h=h||this.options.styles[a];if(r+=0|h.lineWidth,s+=0|h.lineWidth,"circle"===a?e=this.createCircle(r,s,t.radius,h):"convex-polygon"===a&&(e=this.createPolygon(t.vertices,h)),h.angleIndicator&&(e.beginFill(h.angleIndicator),e.moveTo(r/2,5+h.lineWidth),e.lineTo(r/2+t.radius/2,t.radius),e.endFill()),e)return this.stage.addChild(e),e;throw"Invalid view name passed."},drawMeta:function(t){if(this.meta.loaded)this.meta.fps.setText("FPS: "+t.fps.toFixed(2)),this.meta.ipf.setText("IPF: "+t.ipf);else{var e={font:"18px Snippet",fill:"white",align:"left"};this.meta.fps=new PIXI.Text("FPS: "+t.fps.toFixed(2),e),this.meta.fps.position.x=15,this.meta.fps.position.y=5,this.meta.ipf=new PIXI.Text("IPF: "+t.ipf,e),this.meta.ipf.position.x=15,this.meta.ipf.position.y=30,this.stage.addChild(this.meta.fps),this.stage.addChild(this.meta.ipf),this.meta.loaded=!0}},createDisplay:function(t,e){var i=null,n=null;switch(t){case"sprite":return n=PIXI.Texture.fromImage(e.texture),i=new PIXI.Sprite(n),e.anchor&&(i.anchor.x=e.anchor.x,i.anchor.y=e.anchor.y),e.container?e.container.addChild(i):this.stage.addChild(i),i;case"movieclip":if(!this.assetsLoaded)throw"No assets have been loaded. Use loadSpritesheet() first";var o=[],r=0;for(r;r<e.frames.length;r++)n=PIXI.Texture.fromFrame(e.frames[r]),o.push(n);return i=new PIXI.MovieClip(o),e.anchor&&(i.anchor.x=e.anchor.x,i.anchor.y=e.anchor.y),e.container?e.container.addChild(i):this.stage.addChild(i),i;default:throw"Invalid PIXI.DisplayObject passed"
}},centerAnchor:function(t){null!==t&&(t.anchor.x=.5,t.anchor.y=.5)}}}),i});</script>
<script>function init(){Physics(function(e){var t=window.innerWidth,i=window.innerHeight,n=document.querySelector("#launcher"),r=Physics.renderer("dom",{el:"viewport",width:t,height:i,meta:!1});e.add(r),e.on("step",function(){e.render()});var a=Physics.aabb(0,-100,t,n.offsetTop);e.add(Physics.behavior("edge-collision-detection",{aabb:a,restitution:.5,cof:.5}));for(var o=0;60>o;o++)setTimeout(function(){e.add(Physics.body("rectangle",{x:t/2,y:0,vx:Math.random()/15*(Math.random()>.5?1:-1),vy:.1*Math.random()+.4,width:42,height:42,cof:.5,restitution:.6}))},2e3*Math.random());e.add(Physics.behavior("body-impulse-response"));var c=Physics.behavior("constant-acceleration");c.setAcceleration({x:0,y:4e-4}),e.add(c),Physics.util.ticker.on(function(t){e.step(t)}),Physics.util.ticker.start()})}var readyInterval=setInterval(function(){document.querySelector("#launcher")&&(clearInterval(readyInterval),init())},1);</script>
